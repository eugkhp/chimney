

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Lifted Transformers (deprecated) &mdash; Chimney 0.7.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Cats integration (deprecated)" href="cats-integration.html" />
    <link rel="prev" title="Cats integration" href="../partial-transformers/cats-integration.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Chimney
          

          
          </a>

          
            
            
              <div class="version">
                0.7.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/community.html">Community</a></li>
</ul>
<p class="caption"><span class="caption-text">Transformers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../transformers/getting-started.html">Getting started with transformers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../transformers/customizing-transformers.html">Customizing transformers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../transformers/standard-transformers.html">Standard transformers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../transformers/default-values.html">Default values support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../transformers/own-transformations.html">Plugging in own transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../transformers/scoped-configuration.html">Providing scoped configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../transformers/java-beans.html">Java beans</a></li>
<li class="toctree-l1"><a class="reference internal" href="../transformers/unsafe-options.html">Unsafe options <code class="docutils literal notranslate"><span class="pre">(deprecated)</span></code></a></li>
</ul>
<p class="caption"><span class="caption-text">Partial Transformers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../partial-transformers/partial-transformers.html">Partial transformers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../partial-transformers/migrating-from-lifted.html">Migrating from Lifted Transformers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../partial-transformers/total-vs-partial-conflicts.html">Total vs partial conflicts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../partial-transformers/cats-integration.html">Cats integration</a></li>
</ul>
<p class="caption"><span class="caption-text">Lifted Transformers</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Lifted Transformers <code class="docutils literal notranslate"><span class="pre">(deprecated)</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#lifted-dsl-operations">Lifted DSL operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#capturing-validation-errors">Capturing validation errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="#transformerf-type-class"><code class="docutils literal notranslate"><span class="pre">TransformerF</span></code> type class</a></li>
<li class="toctree-l2"><a class="reference internal" href="#supporting-custom-f">Supporting custom <code class="docutils literal notranslate"><span class="pre">F[_]</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#error-path-support">Error path support</a></li>
<li class="toctree-l2"><a class="reference internal" href="#emitted-code">Emitted code</a></li>
<li class="toctree-l2"><a class="reference internal" href="#deriving-lifted-transformers">Deriving lifted transformers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cats-integration.html">Cats integration <code class="docutils literal notranslate"><span class="pre">(deprecated)</span></code></a></li>
</ul>
<p class="caption"><span class="caption-text">Patchers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../patchers/getting-started.html">Getting started with patchers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../patchers/redundant-fields.html">Redundant fields in patchers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../patchers/options-handling.html">Handling optional fields</a></li>
</ul>
<p class="caption"><span class="caption-text">Benchmarks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../benchmarks.html">Benchmarks</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Chimney</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Lifted Transformers <code class="docutils literal notranslate"><span class="pre">(deprecated)</span></code></li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="lifted-transformers-deprecated">
<span id="lifted-transformers"></span><h1>Lifted Transformers <code class="docutils literal notranslate"><span class="pre">(deprecated)</span></code><a class="headerlink" href="#lifted-transformers-deprecated" title="Permalink to this headline">¶</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This feature is deprecated and most likely will be removed soon.
Consider using <a class="reference internal" href="../partial-transformers/partial-transformers.html#partial-transformers"><span class="std std-ref">Partial transformers</span></a> instead.</p>
</div>
<p>While Chimney transformers wrap total functions of type <code class="docutils literal notranslate"><span class="pre">From</span> <span class="pre">=&gt;</span> <span class="pre">To</span></code>, they don’t
really support partial transformations, where depending on the input value, transformation
may <cite>succeed</cite> or <cite>fail</cite>.</p>
<p>Let’s take a look at the following example.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="k">class</span> <span class="nc">RegistrationForm</span><span class="o">(</span><span class="n">email</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
                            <span class="n">username</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
                            <span class="n">password</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
                            <span class="n">age</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">RegisteredUser</span><span class="o">(</span><span class="n">email</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
                          <span class="n">username</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
                          <span class="n">passwordHash</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
                          <span class="n">age</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>
</pre></div>
</div>
<p>We get field <code class="docutils literal notranslate"><span class="pre">age:</span> <span class="pre">String</span></code> as an input, but we would like to parse it into correct <code class="docutils literal notranslate"><span class="pre">Int</span></code>
or signal an error, if provided value is not valid integer. This is simply not possible
with total <code class="docutils literal notranslate"><span class="pre">Transformer</span></code>. This is a moment when <cite>lifted transformers</cite>, provided
by <a class="reference internal" href="#transformerf-type-class"><span class="std std-ref">TransformerF type class</span></a> come into play.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">okForm</span> <span class="k">=</span> <span class="nc">RegistrationForm</span><span class="o">(</span><span class="s">&quot;john@example.com&quot;</span><span class="o">,</span> <span class="s">&quot;John&quot;</span><span class="o">,</span> <span class="s">&quot;s3cr3t&quot;</span><span class="o">,</span> <span class="s">&quot;40&quot;</span><span class="o">)</span>

<span class="n">okForm</span>
  <span class="o">.</span><span class="n">intoF</span><span class="o">[</span><span class="kt">Option</span><span class="p">,</span> <span class="kt">RegisteredUser</span><span class="o">]</span> <span class="c1">// (1)</span>
  <span class="o">.</span><span class="n">withFieldComputed</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">passwordHash</span><span class="o">,</span> <span class="n">form</span> <span class="k">=&gt;</span> <span class="n">hashpw</span><span class="o">(</span><span class="n">form</span><span class="o">.</span><span class="n">password</span><span class="o">))</span>
  <span class="o">.</span><span class="n">withFieldComputedF</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">age</span><span class="o">,</span> <span class="k">_</span><span class="o">.</span><span class="n">age</span><span class="o">.</span><span class="n">toIntOption</span><span class="o">)</span> <span class="c1">// (2)</span>
  <span class="o">.</span><span class="n">transform</span> <span class="c1">// (3)</span>
<span class="c1">// Some(RegisteredUser(&quot;john@example.com&quot;, &quot;John&quot;, &quot;...&quot;, 40)): Option[RegisteredUser]</span>
</pre></div>
</div>
<p>There are few differences to total transformers in the example above:</p>
<ol class="arabic simple">
<li><p>Instead of <code class="docutils literal notranslate"><span class="pre">into[RegisteredUser]</span></code>, we use <code class="docutils literal notranslate"><span class="pre">intoF[Option,</span> <span class="pre">RegisteredUser]</span></code>, which
tells Chimney that <code class="docutils literal notranslate"><span class="pre">Option</span></code> type will be used for handling partial transformations.</p></li>
<li><p>Instead of <code class="docutils literal notranslate"><span class="pre">withFieldComputed</span></code>, we use <code class="docutils literal notranslate"><span class="pre">withFieldComputedF</span></code>, where second parameter
is a function that wraps result into a type constructor provided in <cite>(1)</cite> - <code class="docutils literal notranslate"><span class="pre">Option</span></code>
in this case.</p></li>
<li><p>Result type of <code class="docutils literal notranslate"><span class="pre">transform</span></code> call is not <code class="docutils literal notranslate"><span class="pre">RegisteredUser</span></code>, but <code class="docutils literal notranslate"><span class="pre">Option[RegisteredUser]</span></code>.</p></li>
</ol>
<p>As you expect, when provided <code class="docutils literal notranslate"><span class="pre">age</span></code> which is not valid integer, this code evaluates to <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">badForm</span> <span class="k">=</span> <span class="nc">RegistrationForm</span><span class="o">(</span><span class="s">&quot;john@example.com&quot;</span><span class="o">,</span> <span class="s">&quot;John&quot;</span><span class="o">,</span> <span class="s">&quot;s3cr3t&quot;</span><span class="o">,</span> <span class="s">&quot;not an int&quot;</span><span class="o">)</span>

<span class="n">badForm</span>
  <span class="o">.</span><span class="n">intoF</span><span class="o">[</span><span class="kt">Option</span><span class="p">,</span> <span class="kt">RegisteredUser</span><span class="o">]</span>
  <span class="o">.</span><span class="n">withFieldComputed</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">passwordHash</span><span class="o">,</span> <span class="n">form</span> <span class="k">=&gt;</span> <span class="n">hashpw</span><span class="o">(</span><span class="n">form</span><span class="o">.</span><span class="n">password</span><span class="o">))</span>
  <span class="o">.</span><span class="n">withFieldComputedF</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">age</span><span class="o">,</span> <span class="k">_</span><span class="o">.</span><span class="n">age</span><span class="o">.</span><span class="n">toIntOption</span><span class="o">)</span>
  <span class="o">.</span><span class="n">transform</span>
<span class="c1">// None: Option[RegisteredUser]</span>
</pre></div>
</div>
<div class="section" id="lifted-dsl-operations">
<h2>Lifted DSL operations<a class="headerlink" href="#lifted-dsl-operations" title="Permalink to this headline">¶</a></h2>
<p>Similar to <code class="docutils literal notranslate"><span class="pre">withFieldConst</span></code>, <code class="docutils literal notranslate"><span class="pre">withFieldComputed</span></code>, <code class="docutils literal notranslate"><span class="pre">withCoproductInstance</span></code> operations in DSL,
there are lifted counterparts available:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">withFieldConstF</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">withFieldComputedF</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">withCoproductInstanceF</span></code></p></li>
</ul>
<p>Analogously to <a class="reference internal" href="../transformers/own-transformations.html#transformer-definition-dsl"><span class="std std-ref">Transformer definition DSL</span></a> for <code class="docutils literal notranslate"><span class="pre">Transformer</span></code>, we can define above transformation
as implicit <code class="docutils literal notranslate"><span class="pre">TransformerF[Option,</span> <span class="pre">RegistrationForm,</span> <span class="pre">RegisteredUser]</span></code>. In order to do this,
we use <code class="docutils literal notranslate"><span class="pre">TransformerF.define</span></code> (or equivalently <code class="docutils literal notranslate"><span class="pre">Transformer.defineF</span></code>).</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">implicit</span> <span class="k">val</span> <span class="n">transformer</span><span class="k">:</span> <span class="kt">TransformerF</span><span class="o">[</span><span class="kt">Option</span><span class="p">,</span> <span class="kt">RegistrationForm</span><span class="p">,</span> <span class="kt">RegisteredUser</span><span class="o">]</span> <span class="k">=</span>
  <span class="nc">TransformerF</span><span class="o">.</span><span class="n">define</span><span class="o">[</span><span class="kt">Option</span><span class="p">,</span> <span class="kt">RegistrationForm</span><span class="p">,</span> <span class="kt">RegisteredUser</span><span class="o">]</span>
    <span class="o">.</span><span class="n">withFieldComputed</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">passwordHash</span><span class="o">,</span> <span class="n">form</span> <span class="k">=&gt;</span> <span class="n">hashpw</span><span class="o">(</span><span class="n">form</span><span class="o">.</span><span class="n">password</span><span class="o">))</span>
    <span class="o">.</span><span class="n">withFieldComputedF</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">age</span><span class="o">,</span> <span class="k">_</span><span class="o">.</span><span class="n">age</span><span class="o">.</span><span class="n">toIntOption</span><span class="o">)</span>
    <span class="o">.</span><span class="n">buildTransformer</span>
</pre></div>
</div>
<p>As commonly, as with total transformers, this instance may be later picked up and used other,
lifted transformations. In the following example it’s used for transforming array of registration
forms into list of registered users.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="nc">Array</span><span class="o">(</span><span class="n">okForm</span><span class="o">,</span> <span class="n">badForm</span><span class="o">).</span><span class="n">transformIntoF</span><span class="o">[</span><span class="kt">Option</span><span class="p">,</span> <span class="kt">List</span><span class="o">[</span><span class="kt">RegisteredUser</span><span class="o">]]</span>
<span class="c1">// None: Option[List[RegisteredUser]]</span>
</pre></div>
</div>
<p>Note that following error handling semantics for collections, we’ve got <code class="docutils literal notranslate"><span class="pre">None</span></code> as a result
(because not all of array elements were valid forms, according to the defined lifted transformer).</p>
</div>
<div class="section" id="capturing-validation-errors">
<span id="id1"></span><h2>Capturing validation errors<a class="headerlink" href="#capturing-validation-errors" title="Permalink to this headline">¶</a></h2>
<p>Usually, when partial transformation failed, we would like to know <cite>why</cite> it failed.
Thus, we must use different wrapper type than <code class="docutils literal notranslate"><span class="pre">Option</span></code> that allows to capture error information.</p>
<p>Chimney supports out of the box <code class="docutils literal notranslate"><span class="pre">Either[C[E],</span> <span class="pre">+*]</span></code>, as the wrapper type, where</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">E</span></code> - type of a single error occurrence</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">C[_]</span></code> - collection type to store all the transformation errors (like <code class="docutils literal notranslate"><span class="pre">Seq</span></code>, <code class="docutils literal notranslate"><span class="pre">Vector</span></code>, <code class="docutils literal notranslate"><span class="pre">List</span></code>, etc.)</p></li>
</ul>
<p>If we pick error type as <code class="docutils literal notranslate"><span class="pre">String</span></code> (as validation error message) and collection as <code class="docutils literal notranslate"><span class="pre">Vector</span></code>,
we obtain wrapper type <code class="docutils literal notranslate"><span class="pre">Either[Vector[String],</span> <span class="pre">+*]</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Type syntax with <code class="docutils literal notranslate"><span class="pre">+*</span></code> is only available with
<a class="reference external" href="https://github.com/typelevel/kind-projector">kind-projector compiler plugin</a>.
If you don’t want to (or can’t) use it, you may either use type-lambda with weird syntax:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">({</span><span class="k">type</span> <span class="kt">L</span><span class="o">[</span><span class="kt">+X</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Either</span><span class="o">[</span><span class="kt">Vector</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span><span class="p">,</span> <span class="kt">X</span><span class="o">]})</span><span class="k">#</span><span class="n">L</span>
</pre></div>
</div>
<p>or define type alias:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">type</span> <span class="kt">EitherVecStr</span><span class="o">[</span><span class="kt">+X</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Either</span><span class="o">[</span><span class="kt">Vector</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span><span class="p">,</span> <span class="kt">X</span><span class="o">]</span>
</pre></div>
</div>
<p>and use type <code class="docutils literal notranslate"><span class="pre">EitherVecStr</span></code> as a lifted wrapper type.</p>
</div>
<p>Let’s enhance our <code class="docutils literal notranslate"><span class="pre">RegistrationForm</span></code> to <code class="docutils literal notranslate"><span class="pre">RegisteredUser</span></code> lifted transformer with few
additional validation rules:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">email</span></code> field should contain <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> character</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">age</span></code> must be at least <code class="docutils literal notranslate"><span class="pre">18</span></code> years</p></li>
</ul>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">implicit</span> <span class="k">val</span> <span class="n">transformer</span><span class="k">:</span> <span class="kt">TransformerF</span><span class="o">[</span><span class="kt">EitherVecStr</span><span class="p">,</span> <span class="kt">RegistrationForm</span><span class="p">,</span> <span class="kt">RegisteredUser</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
  <span class="nc">Transformer</span><span class="o">.</span><span class="n">defineF</span><span class="o">[</span><span class="kt">EitherVecStr</span><span class="p">,</span> <span class="kt">RegistrationForm</span><span class="p">,</span> <span class="kt">RegisteredUser</span><span class="o">]</span>
    <span class="o">.</span><span class="n">withFieldComputedF</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">email</span><span class="o">,</span> <span class="n">form</span> <span class="k">=&gt;</span> <span class="o">{</span>
      <span class="k">if</span><span class="o">(</span><span class="n">form</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">contains</span><span class="o">(</span><span class="sc">&#39;@&#39;</span><span class="o">))</span> <span class="o">{</span>
        <span class="nc">Right</span><span class="o">(</span><span class="n">form</span><span class="o">.</span><span class="n">email</span><span class="o">)</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="nc">Left</span><span class="o">(</span><span class="nc">Vector</span><span class="o">(</span><span class="s">s&quot;</span><span class="si">${</span><span class="n">form</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="s">&#39;s email: does not contain &#39;@&#39; character&quot;</span><span class="o">))</span>
      <span class="o">}</span>
    <span class="o">})</span>
    <span class="o">.</span><span class="n">withFieldComputed</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">passwordHash</span><span class="o">,</span> <span class="n">form</span> <span class="k">=&gt;</span> <span class="n">hashpw</span><span class="o">(</span><span class="n">form</span><span class="o">.</span><span class="n">password</span><span class="o">))</span>
    <span class="o">.</span><span class="n">withFieldComputedF</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">age</span><span class="o">,</span> <span class="n">form</span> <span class="k">=&gt;</span> <span class="n">form</span><span class="o">.</span><span class="n">age</span><span class="o">.</span><span class="n">toIntOption</span> <span class="k">match</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">Some</span><span class="o">(</span><span class="n">value</span><span class="o">)</span> <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;=</span> <span class="mi">18</span> <span class="k">=&gt;</span> <span class="nc">Right</span><span class="o">(</span><span class="n">value</span><span class="o">)</span>
      <span class="k">case</span> <span class="nc">Some</span><span class="o">(</span><span class="n">value</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nc">Left</span><span class="o">(</span><span class="nc">Vector</span><span class="o">(</span><span class="s">s&quot;</span><span class="si">${</span><span class="n">form</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="s">&#39;s age: must have at least 18 years&quot;</span><span class="o">))</span>
      <span class="k">case</span> <span class="nc">None</span> <span class="k">=&gt;</span> <span class="nc">Left</span><span class="o">(</span><span class="nc">Vector</span><span class="o">(</span><span class="s">s&quot;</span><span class="si">${</span><span class="n">form</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="s">&#39;s age: invalid number&quot;</span><span class="o">))</span>
    <span class="o">})</span>
    <span class="o">.</span><span class="n">buildTransformer</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Then, trying to transform multiple registration forms, we can validate all them at once:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="nc">Array</span><span class="o">(</span>
  <span class="nc">RegistrationForm</span><span class="o">(</span><span class="s">&quot;john_example.com&quot;</span><span class="o">,</span> <span class="s">&quot;John&quot;</span><span class="o">,</span> <span class="s">&quot;s3cr3t&quot;</span><span class="o">,</span> <span class="s">&quot;10&quot;</span><span class="o">),</span>
  <span class="nc">RegistrationForm</span><span class="o">(</span><span class="s">&quot;alice@example.com&quot;</span><span class="o">,</span> <span class="s">&quot;Alice&quot;</span><span class="o">,</span> <span class="s">&quot;s3cr3t&quot;</span><span class="o">,</span> <span class="s">&quot;19&quot;</span><span class="o">),</span>
  <span class="nc">RegistrationForm</span><span class="o">(</span><span class="s">&quot;bob@example.com&quot;</span><span class="o">,</span> <span class="s">&quot;Bob&quot;</span><span class="o">,</span> <span class="s">&quot;s3cr3t&quot;</span><span class="o">,</span> <span class="s">&quot;21.5&quot;</span><span class="o">)</span>
<span class="o">).</span><span class="n">transformIntoF</span><span class="o">[</span><span class="kt">EitherVecStr</span><span class="p">,</span> <span class="kt">List</span><span class="o">[</span><span class="kt">RegisteredUser</span><span class="o">]]</span>
<span class="c1">// Left(</span>
<span class="c1">//   Vector(</span>
<span class="c1">//     &quot;John&#39;s email: does not contain &#39;@&#39; character&quot;,</span>
<span class="c1">//     &quot;John&#39;s age: must have at least 18 years&quot;,</span>
<span class="c1">//     &quot;Bob&#39;s age: invalid number&quot;,</span>
<span class="c1">//   )</span>
<span class="c1">// )</span>
</pre></div>
</div>
<p>In case when all the provided forms are correct, we obtain requested collection of
registered users, wrapped in <code class="docutils literal notranslate"><span class="pre">Right</span></code>.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="nc">Array</span><span class="o">(</span>
  <span class="nc">RegistrationForm</span><span class="o">(</span><span class="s">&quot;john@example.com&quot;</span><span class="o">,</span> <span class="s">&quot;John&quot;</span><span class="o">,</span> <span class="s">&quot;s3cr3t&quot;</span><span class="o">,</span> <span class="s">&quot;40&quot;</span><span class="o">),</span>
  <span class="nc">RegistrationForm</span><span class="o">(</span><span class="s">&quot;alice@example.com&quot;</span><span class="o">,</span> <span class="s">&quot;Alice&quot;</span><span class="o">,</span> <span class="s">&quot;s3cr3t&quot;</span><span class="o">,</span> <span class="s">&quot;19&quot;</span><span class="o">),</span>
  <span class="nc">RegistrationForm</span><span class="o">(</span><span class="s">&quot;bob@example.com&quot;</span><span class="o">,</span> <span class="s">&quot;Bob&quot;</span><span class="o">,</span> <span class="s">&quot;s3cr3t&quot;</span><span class="o">,</span> <span class="s">&quot;21&quot;</span><span class="o">)</span>
<span class="o">).</span><span class="n">transformIntoF</span><span class="o">[</span><span class="kt">EitherVecStr</span><span class="p">,</span> <span class="kt">List</span><span class="o">[</span><span class="kt">RegisteredUser</span><span class="o">]]</span>
<span class="c1">// Right(</span>
<span class="c1">//   List(</span>
<span class="c1">//     RegisteredUser(&quot;john@example.com&quot;, &quot;John&quot;, &quot;...&quot;, 40)</span>
<span class="c1">//     RegisteredUser(&quot;alice@example.com&quot;, &quot;Alice&quot;, &quot;...&quot;, 19),</span>
<span class="c1">//     RegisteredUser(&quot;bob@example.com&quot;, &quot;Bob&quot;, &quot;...&quot;, 21)</span>
<span class="c1">//   )</span>
<span class="c1">// )</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Note that collection type where you gather errors is independent of
any eventual collection types that takes part in the transformation.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">Either</span></code> wrappers, Chimney supports practically any Scala standard collection
type, but depending on your choice, you may obtain different performance characteristics.
Thus, collections with reasonably fast concatenation should be preferred on the
error channel.</p>
</div>
<p>If you prefer to use <a class="reference external" href="https://typelevel.org/cats">Cats</a> library, you might be
interested in <a class="reference internal" href="cats-integration.html#cats-validated"><span class="std std-ref">Validated support for lifted transformers</span></a>.</p>
</div>
<div class="section" id="transformerf-type-class">
<span id="id2"></span><h2><code class="docutils literal notranslate"><span class="pre">TransformerF</span></code> type class<a class="headerlink" href="#transformerf-type-class" title="Permalink to this headline">¶</a></h2>
<p>Similar to the <a class="reference internal" href="../transformers/own-transformations.html#transformer-typeclass"><span class="std std-ref">Transformer type class</span></a>, Chimney defines a <code class="docutils literal notranslate"><span class="pre">TransformerF</span></code> type class,
which allows to express partial (<cite>lifted</cite>, <cite>wrapped</cite>) transformation of type <code class="docutils literal notranslate"><span class="pre">From</span> <span class="pre">=&gt;</span> <span class="pre">F[To]</span></code>.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">trait</span> <span class="nc">TransformerF</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="kt">+</span><span class="k">_</span><span class="o">]</span><span class="p">,</span> <span class="kt">From</span><span class="p">,</span> <span class="kt">To</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">transform</span><span class="o">(</span><span class="n">src</span><span class="k">:</span> <span class="kt">From</span><span class="o">)</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">To</span><span class="o">]</span>
<span class="o">}</span>
</pre></div>
</div>
<p>The whole library functionality that refers to total transformers,
is also supported for lifted transformers. This especially means:</p>
<ul class="simple">
<li><p>local implicit instances of <code class="docutils literal notranslate"><span class="pre">TransformerF</span></code> are preferred in the first place,
before deriving as instance by a macro (read more about it in <a class="reference internal" href="#deriving-transformerf"><span class="std std-ref">Deriving lifted transformers</span></a>)</p></li>
<li><p>all the <code class="docutils literal notranslate"><span class="pre">enable</span></code>/<code class="docutils literal notranslate"><span class="pre">disable</span></code> flags are respected by lifted transformers</p></li>
<li><p>you can customize lifted transformers using any operation described in
<a class="reference internal" href="../transformers/customizing-transformers.html#customizing-transformers"><span class="std std-ref">Customizing transformers</span></a> which works as well for total transformers,
as for lifted ones</p></li>
<li><p>all the <a class="reference internal" href="../transformers/standard-transformers.html#standard-transformers"><span class="std std-ref">Standard transformers</span></a> rules are provided for lifted transformers too</p></li>
<li><p>derivation for case classes, tuples, Java beans are supported too</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that for convenience of some operations, <code class="docutils literal notranslate"><span class="pre">F</span></code> is defined with as
<cite>covariant</cite> type constructor.</p>
</div>
</div>
<div class="section" id="supporting-custom-f">
<h2>Supporting custom <code class="docutils literal notranslate"><span class="pre">F[_]</span></code><a class="headerlink" href="#supporting-custom-f" title="Permalink to this headline">¶</a></h2>
<p>Chimney provides pluggable interface that allows you to use your own
<code class="docutils literal notranslate"><span class="pre">F[_]</span></code> type constructor in lifted transformations.</p>
<p>The library defines <code class="docutils literal notranslate"><span class="pre">TransformerFSupport</span></code> type class, as follows.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">trait</span> <span class="nc">TransformerFSupport</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="kt">+</span><span class="k">_</span><span class="o">]]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">pure</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">value</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
  <span class="k">def</span> <span class="n">product</span><span class="o">[</span><span class="kt">A</span><span class="p">,</span> <span class="kt">B</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">],</span> <span class="n">fb</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="n">F</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">F</span><span class="o">[(</span><span class="kt">A</span><span class="p">,</span> <span class="kt">B</span><span class="o">)]</span>
  <span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">A</span><span class="p">,</span> <span class="kt">B</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">],</span> <span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span>
  <span class="k">def</span> <span class="n">traverse</span><span class="o">[</span><span class="kt">M</span><span class="p">,</span> <span class="kt">A</span><span class="p">,</span> <span class="kt">B</span><span class="o">](</span><span class="n">it</span><span class="k">:</span> <span class="kt">Iterator</span><span class="o">[</span><span class="kt">A</span><span class="o">],</span> <span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">F</span><span class="o">[</span><span class="kt">B</span><span class="o">])(</span><span class="k">implicit</span> <span class="n">fac</span><span class="k">:</span> <span class="kt">Factory</span><span class="o">[</span><span class="kt">B</span><span class="p">,</span> <span class="kt">M</span><span class="o">])</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">M</span><span class="o">]</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Chimney macros, during lifted transformer derivation, resolve implicit instance
of <code class="docutils literal notranslate"><span class="pre">TransformerFSupport</span></code> for requested wrapper type constructor and use it
in various places in emitted code.</p>
</div>
<p>In order to be able to use wrapper type of your choice, you need to implement
an instance of <code class="docutils literal notranslate"><span class="pre">TransformerFSupport</span></code> and put it as implicit term in the scope of usage.</p>
<p>For those familiar with <cite>applicative functors</cite> and <cite>traversable</cite> type classes,
implementation of these methods should be obvious. Yet it gives some choice about
semantics of error handling.</p>
<p>Chimney supports <code class="docutils literal notranslate"><span class="pre">Option</span></code>, <code class="docutils literal notranslate"><span class="pre">Either</span></code> and <code class="docutils literal notranslate"><span class="pre">cats.data.Validated</span></code>
(in <a class="reference internal" href="cats-integration.html#lifted-cats-integration"><span class="std std-ref">Cats integration (deprecated)</span></a>) just exactly by providing implicit instaces of
<code class="docutils literal notranslate"><span class="pre">TransformerFSupport</span></code> implemented for those wrapper types.</p>
</div>
<div class="section" id="error-path-support">
<h2>Error path support<a class="headerlink" href="#error-path-support" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Support for enhanced error paths is currently an experimental feature and we don’t
guarantee it will be included in the next library versions in the same shape.</p>
</div>
<p>Chimney provides ability to trace errors in lifted transformers.
For using it you need to implement an instance of <code class="docutils literal notranslate"><span class="pre">TransformerFErrorPathSupport</span></code></p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">trait</span> <span class="nc">TransformerFErrorPathSupport</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="kt">+</span><span class="k">_</span><span class="o">]]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">addPath</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">],</span> <span class="n">node</span><span class="k">:</span> <span class="kt">ErrorPathNode</span><span class="o">)</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
<span class="o">}</span>
</pre></div>
</div>
<dl class="simple">
<dt>There are 4 different types of of <code class="docutils literal notranslate"><span class="pre">ErrorPathNode</span></code>:</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Accessor</span></code> for case class field or java bean getter</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Index</span></code> for collection index</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MapKey</span></code> for map key</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MapValue</span></code> for map value</p></li>
</ul>
</dd>
</dl>
<p>In case if Chimney can resolve instance of <code class="docutils literal notranslate"><span class="pre">TransformerFErrorPathSupport</span></code> in scope of your
lifted transformer, each error in transformation will contain path of nodes to error location</p>
<dl class="simple">
<dt>Out of box Chimney contains instance for Either[C[TransformationError[M]], +*], where</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">M</span></code> - type of error message</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">C[_]</span></code> - collection type to store all the transformation errors (like Seq, Vector, List, etc.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TransformationError</span></code> - default implementation of error containing path</p></li>
</ul>
</dd>
</dl>
<p>Let’s take a look at the following example:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">type</span> <span class="kt">V</span><span class="o">[</span><span class="kt">+A</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Either</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">TransformationError</span><span class="o">[</span><span class="kt">String</span><span class="o">]]</span><span class="p">,</span> <span class="kt">A</span><span class="o">]</span>

<span class="k">implicit</span> <span class="k">val</span> <span class="n">intParse</span><span class="k">:</span> <span class="kt">TransformerF</span><span class="o">[</span><span class="kt">V</span><span class="p">,</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">Int</span><span class="o">]</span> <span class="k">=</span>
  <span class="n">str</span> <span class="k">=&gt;</span> <span class="nc">Try</span><span class="o">(</span><span class="n">str</span><span class="o">.</span><span class="n">toInt</span><span class="o">).</span><span class="n">toEither</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span> <span class="k">=&gt;</span> <span class="nc">List</span><span class="o">(</span><span class="nc">TransformationError</span><span class="o">(</span><span class="s">s&quot;Can&#39;t parse int from &#39;</span><span class="si">$str</span><span class="s">&#39;&quot;</span><span class="o">)))</span>

<span class="c1">// Raw domain</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">RawData</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">links</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">RawLink</span><span class="o">])</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">RawLink</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">mapping</span><span class="k">:</span> <span class="kt">Map</span><span class="o">[</span><span class="kt">RawLinkKey</span><span class="p">,</span> <span class="kt">RawLinkValue</span><span class="o">])</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">RawLinkKey</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">RawLinkValue</span><span class="o">(</span><span class="n">value</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>

<span class="c1">// Domain</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Data</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">links</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Link</span><span class="o">])</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">Link</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">mapping</span><span class="k">:</span> <span class="kt">Map</span><span class="o">[</span><span class="kt">LinkKey</span><span class="p">,</span> <span class="kt">LinkValue</span><span class="o">])</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">LinkKey</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">LinkValue</span><span class="o">(</span><span class="n">value</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>

<span class="k">val</span> <span class="n">rawData</span> <span class="k">=</span> <span class="nc">RawData</span><span class="o">(</span>
  <span class="s">&quot;undefined&quot;</span><span class="o">,</span>
  <span class="nc">List</span><span class="o">(</span><span class="nc">RawLink</span><span class="o">(</span><span class="s">&quot;null&quot;</span><span class="o">,</span> <span class="nc">Map</span><span class="o">(</span><span class="nc">RawLinkKey</span><span class="o">(</span><span class="s">&quot;error&quot;</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="nc">RawLinkValue</span><span class="o">(</span><span class="s">&quot;invalid&quot;</span><span class="o">))))</span>
<span class="o">)</span>

<span class="c1">// Errors output</span>
<span class="n">rawData</span><span class="o">.</span><span class="n">transformIntoF</span><span class="o">[</span><span class="kt">V</span><span class="p">,</span> <span class="kt">Data</span><span class="o">]</span> <span class="o">==</span> <span class="nc">Left</span><span class="o">(</span>
  <span class="nc">List</span><span class="o">(</span>
    <span class="nc">TransformationError</span><span class="o">(</span>
      <span class="s">&quot;Can&#39;t parse int from undefined&quot;</span><span class="o">,</span>
      <span class="nc">List</span><span class="o">(</span><span class="nc">Accessor</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">))</span>
    <span class="o">),</span>
    <span class="nc">TransformationError</span><span class="o">(</span>
      <span class="s">&quot;Can&#39;t parse int from null&quot;</span><span class="o">,</span>
      <span class="nc">List</span><span class="o">(</span><span class="nc">Accessor</span><span class="o">(</span><span class="s">&quot;links&quot;</span><span class="o">),</span> <span class="nc">Index</span><span class="o">(</span><span class="mi">0</span><span class="o">),</span> <span class="nc">Accessor</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">))</span>
    <span class="o">),</span>
    <span class="nc">TransformationError</span><span class="o">(</span>
      <span class="s">&quot;Can&#39;t parse int from error&quot;</span><span class="o">,</span>
      <span class="nc">List</span><span class="o">(</span>
        <span class="nc">Accessor</span><span class="o">(</span><span class="s">&quot;links&quot;</span><span class="o">),</span>
        <span class="nc">Index</span><span class="o">(</span><span class="mi">0</span><span class="o">),</span>
        <span class="nc">Accessor</span><span class="o">(</span><span class="s">&quot;mapping&quot;</span><span class="o">),</span>
        <span class="nc">MapKey</span><span class="o">(</span><span class="nc">RawLinkKey</span><span class="o">(</span><span class="s">&quot;error&quot;</span><span class="o">)),</span>
        <span class="nc">Accessor</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">)</span>
      <span class="o">)</span>
    <span class="o">),</span>
    <span class="nc">TransformationError</span><span class="o">(</span>
      <span class="s">&quot;Can&#39;t parse int from invalid&quot;</span><span class="o">,</span>
      <span class="nc">List</span><span class="o">(</span>
        <span class="nc">Accessor</span><span class="o">(</span><span class="s">&quot;links&quot;</span><span class="o">),</span>
        <span class="nc">Index</span><span class="o">(</span><span class="mi">0</span><span class="o">),</span>
        <span class="nc">Accessor</span><span class="o">(</span><span class="s">&quot;mapping&quot;</span><span class="o">),</span>
        <span class="nc">MapValue</span><span class="o">(</span><span class="nc">RawLinkKey</span><span class="o">(</span><span class="s">&quot;error&quot;</span><span class="o">)),</span>
        <span class="nc">Accessor</span><span class="o">(</span><span class="s">&quot;value&quot;</span><span class="o">)</span>
      <span class="o">)</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">)</span>

<span class="c1">// Using build in showErrorPath</span>
<span class="k">def</span> <span class="n">printError</span><span class="o">(</span><span class="n">err</span><span class="k">:</span> <span class="kt">TransformationError</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span>
  <span class="s">s&quot;</span><span class="si">${</span><span class="n">err</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s"> on </span><span class="si">${</span><span class="n">err</span><span class="o">.</span><span class="n">showErrorPath</span><span class="si">}</span><span class="s">&quot;</span>

<span class="n">rawData</span><span class="o">.</span><span class="n">transformIntoF</span><span class="o">[</span><span class="kt">V</span><span class="p">,</span> <span class="kt">Data</span><span class="o">].</span><span class="n">left</span><span class="o">.</span><span class="n">toOption</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">printError</span><span class="o">))</span> <span class="o">==</span>
  <span class="nc">Some</span><span class="o">(</span>
    <span class="nc">List</span><span class="o">(</span>
      <span class="s">&quot;Can&#39;t parse int from undefined on id&quot;</span><span class="o">,</span>
      <span class="s">&quot;Can&#39;t parse int from null on links(0).id&quot;</span><span class="o">,</span>
      <span class="s">&quot;Can&#39;t parse int from error on links(0).mapping.keys(RawLinkKey(error)).id&quot;</span><span class="o">,</span>
      <span class="s">&quot;Can&#39;t parse int from invalid on links(0).mapping(RawLinkKey(error)).value&quot;</span>
    <span class="o">)</span>
  <span class="o">)</span>
</pre></div>
</div>
</div>
<div class="section" id="emitted-code">
<h2>Emitted code<a class="headerlink" href="#emitted-code" title="Permalink to this headline">¶</a></h2>
<p>Curious how the emitted code for lifted transformers looks like?</p>
<p>Let’s first refactor the transformation defined above, which is equivalent to the
previous one, but with few functions extracted out - their implementation is not
really important at this point.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="n">validateEmail</span><span class="o">(</span><span class="n">form</span><span class="k">:</span> <span class="kt">RegistrationForm</span><span class="o">)</span><span class="k">:</span> <span class="kt">EitherVecStr</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>
<span class="k">def</span> <span class="n">computePasswordHash</span><span class="o">(</span><span class="n">form</span><span class="k">:</span> <span class="kt">RegistrationForm</span><span class="o">)</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="o">...</span>
<span class="k">def</span> <span class="n">validateAge</span><span class="o">(</span><span class="n">form</span><span class="k">:</span> <span class="kt">RegistrationForm</span><span class="o">)</span><span class="k">:</span> <span class="kt">EitherVecStr</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>

<span class="k">implicit</span> <span class="k">val</span> <span class="n">transformer</span><span class="k">:</span> <span class="kt">TransformerF</span><span class="o">[</span><span class="kt">EitherVecStr</span><span class="p">,</span> <span class="kt">RegistrationForm</span><span class="p">,</span> <span class="kt">RegisteredUser</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
  <span class="nc">Transformer</span><span class="o">.</span><span class="n">defineF</span><span class="o">[</span><span class="kt">EitherVecStr</span><span class="p">,</span> <span class="kt">RegistrationForm</span><span class="p">,</span> <span class="kt">RegisteredUser</span><span class="o">]</span>
    <span class="o">.</span><span class="n">withFieldComputedF</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">email</span><span class="o">,</span> <span class="n">validateEmail</span><span class="o">)</span>
    <span class="o">.</span><span class="n">withFieldComputed</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">passwordHash</span><span class="o">,</span> <span class="n">computePasswordHash</span><span class="o">)</span>
    <span class="o">.</span><span class="n">withFieldComputedF</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">age</span><span class="o">,</span> <span class="n">validateAge</span><span class="o">)</span>
    <span class="o">.</span><span class="n">buildTransformer</span>
<span class="o">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">.buildTransformer</span></code> call generates implementation of <code class="docutils literal notranslate"><span class="pre">TransformerF</span></code>, which is
semantically equivalent to the following, hand-crafted version.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">implicit</span> <span class="k">val</span> <span class="n">transformer</span><span class="k">:</span> <span class="kt">TransformerF</span><span class="o">[</span><span class="kt">EitherVecStr</span><span class="p">,</span> <span class="kt">RegistrationForm</span><span class="p">,</span> <span class="kt">RegisteredUser</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>

  <span class="k">val</span> <span class="n">tfs</span><span class="k">:</span> <span class="kt">TransformerFSupport</span><span class="o">[</span><span class="kt">EitherVecStr</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span> <span class="c1">// resolved implicit instance</span>

  <span class="k">new</span> <span class="nc">TransformerF</span><span class="o">[</span><span class="kt">EitherVecStr</span><span class="p">,</span> <span class="kt">RegistrationForm</span><span class="p">,</span> <span class="kt">RegisteredUser</span><span class="o">]</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">transform</span><span class="o">(</span><span class="n">form</span><span class="k">:</span> <span class="kt">RegistrationForm</span><span class="o">)</span><span class="k">:</span> <span class="kt">EitherVecStr</span><span class="o">[</span><span class="kt">RegisteredUser</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
      <span class="n">tfs</span><span class="o">.</span><span class="n">map</span><span class="o">(</span>
        <span class="n">tfs</span><span class="o">.</span><span class="n">product</span><span class="o">(</span><span class="n">validateEmail</span><span class="o">(</span><span class="n">form</span><span class="o">),</span> <span class="n">validateAge</span><span class="o">(</span><span class="n">form</span><span class="o">)),</span>
        <span class="o">{</span> <span class="k">case</span> <span class="o">(</span><span class="n">email</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">age</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=&gt;</span>
          <span class="nc">RegisteredUser</span><span class="o">(</span>
            <span class="n">email</span><span class="o">,</span>
            <span class="n">form</span><span class="o">.</span><span class="n">username</span><span class="o">,</span>
            <span class="n">computePasswordHash</span><span class="o">(</span><span class="n">form</span><span class="o">.</span><span class="n">password</span><span class="o">),</span>
            <span class="n">age</span>
          <span class="o">)</span>
        <span class="o">}</span>
      <span class="o">)</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">tfs.product</span></code> is used to combine results of successful validations into
a tuple type <code class="docutils literal notranslate"><span class="pre">(email,</span> <span class="pre">age):</span> <span class="pre">(String,</span> <span class="pre">Int)</span></code>. In case that some validations
failed, validation errors are combined together also by <code class="docutils literal notranslate"><span class="pre">tfs.product</span></code>.</p>
<p>Then, if all validations passed, <code class="docutils literal notranslate"><span class="pre">tfs.map</span></code> transforms their results to
a target value of type <code class="docutils literal notranslate"><span class="pre">RegisteredUser</span></code>. Otherwise, <code class="docutils literal notranslate"><span class="pre">tfs.map</span></code> just
passes validation errors as a final result.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>only functions provided by <code class="docutils literal notranslate"><span class="pre">withFieldComputedF</span></code> are working with the wrapper
type <code class="docutils literal notranslate"><span class="pre">F</span></code></p></li>
<li><p>remaining fields transformations (indentity transformer for
<code class="docutils literal notranslate"><span class="pre">username</span></code> and a function provided by <code class="docutils literal notranslate"><span class="pre">withFieldComputed</span></code> for <code class="docutils literal notranslate"><span class="pre">password</span></code>)
work without any wrapping with <code class="docutils literal notranslate"><span class="pre">F</span></code></p></li>
</ul>
<p>This strategy leads to generating particularly efficient code.</p>
</div>
</div>
<div class="section" id="deriving-lifted-transformers">
<span id="deriving-transformerf"></span><h2>Deriving lifted transformers<a class="headerlink" href="#deriving-lifted-transformers" title="Permalink to this headline">¶</a></h2>
<p>When deriving a <code class="docutils literal notranslate"><span class="pre">TransformerF[F,</span> <span class="pre">From,</span> <span class="pre">To]</span></code> instance, where:</p>
<ul class="simple">
<li><p>type <code class="docutils literal notranslate"><span class="pre">From</span></code> consists of some type <code class="docutils literal notranslate"><span class="pre">F1</span></code></p></li>
<li><p>type <code class="docutils literal notranslate"><span class="pre">To</span></code> consists of some type <code class="docutils literal notranslate"><span class="pre">T1</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">F1</span></code> in <code class="docutils literal notranslate"><span class="pre">From</span></code> is a counterpart of <code class="docutils literal notranslate"><span class="pre">T1</span></code> in <code class="docutils literal notranslate"><span class="pre">To</span></code></p></li>
</ul>
<p>…we need to have transformation from <code class="docutils literal notranslate"><span class="pre">F1</span></code> to <code class="docutils literal notranslate"><span class="pre">T1</span></code> in order to be able to
derive requested <code class="docutils literal notranslate"><span class="pre">TransformerF</span></code>.</p>
<p>The rule is that:</p>
<ol class="arabic simple">
<li><p>we first check for function <code class="docutils literal notranslate"><span class="pre">F1</span> <span class="pre">=&gt;</span> <span class="pre">F[T1]</span></code> passed to lifted DSL
operations (<code class="docutils literal notranslate"><span class="pre">withFieldConstF</span></code>, <code class="docutils literal notranslate"><span class="pre">withFieldComputedF</span></code>, etc.)
or function <code class="docutils literal notranslate"><span class="pre">F1</span> <span class="pre">=&gt;</span> <span class="pre">T1</span></code> passed to total DSL operations
(<code class="docutils literal notranslate"><span class="pre">withFieldConst</span></code>, <code class="docutils literal notranslate"><span class="pre">withFieldComputed</span></code>, etc.)</p>
<ul class="simple">
<li><p>whichever was found, it’s used in the first place</p></li>
<li><p>the last one passed in DSL for given field/type wins</p></li>
</ul>
</li>
<li><p>then we look for implicit instances for <code class="docutils literal notranslate"><span class="pre">TransformerF[F,</span> <span class="pre">F1,</span> <span class="pre">T1]</span></code>
and <code class="docutils literal notranslate"><span class="pre">Transformer[F1,</span> <span class="pre">T1]</span></code></p>
<ul class="simple">
<li><p>if both of them were found, ambiguity compilation error is reported</p></li>
<li><p>if only one of them was found, it’s used</p></li>
</ul>
</li>
<li><p>we try to derive lifted <code class="docutils literal notranslate"><span class="pre">TransformerF[F,</span> <span class="pre">F1,</span> <span class="pre">T1]</span></code> using library rules</p></li>
</ol>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="cats-integration.html" class="btn btn-neutral float-right" title="Cats integration (deprecated)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../partial-transformers/cats-integration.html" class="btn btn-neutral float-left" title="Cats integration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2017-2023, scalaland.io

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-116165806-1', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>